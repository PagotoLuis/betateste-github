From 89d6398dc534bcd0eb379733547818583c972ef9 Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Tue, 2 Nov 2021 14:11:27 +0100
Subject: [PATCH 359/361] CVE-2020-25722 pytests: Give computer accounts unique
 (and valid) sAMAccountNames and SPNs

BUG: https://bugzilla.samba.org/show_bug.cgi?id=14564

Signed-off-by: Stefan Metzmacher <metze@samba.org>
---
 python/samba/tests/samba_tool/computer.py | 18 ++++++++++++------
 1 file changed, 12 insertions(+), 6 deletions(-)

diff --git a/python/samba/tests/samba_tool/computer.py b/python/samba/tests/samba_tool/computer.py
index 3110a3b04e8..df109e1b1c9 100644
--- a/python/samba/tests/samba_tool/computer.py
+++ b/python/samba/tests/samba_tool/computer.py
@@ -39,23 +39,29 @@ class ComputerCmdTestCase(SambaToolCmdTest):
         # ips used to test --ip-address option
         self.ipv4 = '10.10.10.10'
         self.ipv6 = '2001:0db8:0a0b:12f0:0000:0000:0000:0001'
+        computer_basename = self.randomName().lower()
         data = [
             {
-                'name': 'testcomputer1',
+                'name': computer_basename + 'cmp1',
                 'ip_address_list': [self.ipv4]
             },
             {
-                'name': 'testcomputer2',
+                'name': computer_basename + 'cmp2',
                 'ip_address_list': [self.ipv6],
-                'service_principal_name_list': ['SPN0']
+                'service_principal_name_list': [
+                    'host/' + computer_basename + 'SPN20',
+                ],
             },
             {
-                'name': 'testcomputer3$',
+                'name': computer_basename + 'cmp3$',
                 'ip_address_list': [self.ipv4, self.ipv6],
-                'service_principal_name_list': ['SPN0', 'SPN1']
+                'service_principal_name_list': [
+                    'host/' + computer_basename + 'SPN30',
+                    'host/' + computer_basename + 'SPN31',
+                ],
             },
             {
-                'name': 'testcomputer4$',
+                'name': computer_basename + 'cmp4$',
             },
         ]
         self.computers = [self._randomComputer(base=item) for item in data]
-- 
2.30.2

