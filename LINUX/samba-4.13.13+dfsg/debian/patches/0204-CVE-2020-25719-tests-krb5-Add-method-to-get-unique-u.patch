From cdf08dbc035262f0b0680c2956a44ced86c6559a Mon Sep 17 00:00:00 2001
From: Joseph Sutton <josephsutton@catalyst.net.nz>
Date: Tue, 19 Oct 2021 15:02:10 +1300
Subject: [PATCH 204/361] CVE-2020-25719 tests/krb5: Add method to get unique
 username for test accounts

BUG: https://bugzilla.samba.org/show_bug.cgi?id=14686

Signed-off-by: Joseph Sutton <josephsutton@catalyst.net.nz>
Reviewed-by: Andrew Bartlett <abartlet@samba.org>
---
 python/samba/tests/krb5/kdc_base_test.py | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/python/samba/tests/krb5/kdc_base_test.py b/python/samba/tests/krb5/kdc_base_test.py
index a0da89041c4..e85574c51cb 100644
--- a/python/samba/tests/krb5/kdc_base_test.py
+++ b/python/samba/tests/krb5/kdc_base_test.py
@@ -711,8 +711,7 @@ class KDCBaseTest(RawKerberosTest):
 
         rodc_dn = self.get_server_dn(rodc_samdb)
 
-        user_name = self.account_base + str(self.account_id)
-        type(self).account_id += 1
+        user_name = self.get_new_username()
         if name_prefix is not None:
             user_name = name_prefix + user_name
         if name_suffix is not None:
@@ -821,6 +820,12 @@ class KDCBaseTest(RawKerberosTest):
 
         return creds
 
+    def get_new_username(self):
+        user_name = self.account_base + str(self.account_id)
+        type(self).account_id += 1
+
+        return user_name
+
     def get_client_creds(self,
                          allow_missing_password=False,
                          allow_missing_keys=True):
-- 
2.30.2

