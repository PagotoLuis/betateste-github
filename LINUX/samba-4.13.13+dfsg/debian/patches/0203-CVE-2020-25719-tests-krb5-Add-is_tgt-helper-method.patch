From 226325081231c48a0c1cb7fde21a58582ba01637 Mon Sep 17 00:00:00 2001
From: Joseph Sutton <josephsutton@catalyst.net.nz>
Date: Thu, 30 Sep 2021 16:53:22 +1300
Subject: [PATCH 203/361] CVE-2020-25719 tests/krb5: Add is_tgt() helper method

BUG: https://bugzilla.samba.org/show_bug.cgi?id=14686

Signed-off-by: Joseph Sutton <josephsutton@catalyst.net.nz>
Reviewed-by: Andrew Bartlett <abartlet@samba.org>
---
 python/samba/tests/krb5/raw_testcase.py | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/python/samba/tests/krb5/raw_testcase.py b/python/samba/tests/krb5/raw_testcase.py
index fdf078ea788..055209fd09d 100644
--- a/python/samba/tests/krb5/raw_testcase.py
+++ b/python/samba/tests/krb5/raw_testcase.py
@@ -3086,8 +3086,7 @@ class RawKerberosTest(TestCaseInTempDir):
     def verify_ticket(self, ticket, krbtgt_key, expect_pac=True,
                       expect_ticket_checksum=True):
         # Check if the ticket is a TGT.
-        sname = ticket.ticket['sname']
-        is_tgt = self.is_tgs(sname)
+        is_tgt = self.is_tgt(ticket)
 
         # Decrypt the ticket.
 
@@ -3506,6 +3505,10 @@ class RawKerberosTest(TestCaseInTempDir):
         name = principal['name-string'][0]
         return name in ('krbtgt', b'krbtgt')
 
+    def is_tgt(self, ticket):
+        sname = ticket.ticket['sname']
+        return self.is_tgs(sname)
+
     def get_empty_pac(self):
         return self.AuthorizationData_create(AD_WIN2K_PAC, bytes(1))
 
-- 
2.30.2

